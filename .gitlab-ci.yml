stages:
  - test
  - cleanup_build
  - package
  - deploy

#before_script:
#   - docker info 
#   - pwd

build-docker-img:
  stage: test
  variables:
    CNAME: swarm-front
    GIT_STRATEGY: none
  before_script:
   - docker info 
   - pwd
  script:
    - docker build -t ${CNAME}:2.0 . # --no-cache 

error:
  stage: test
  variables:
    CNAME: swarm-front
    GIT_STRATEGY: none
  script: 
    - docker rm -f ${CNAME}
  when: on_failure

continue:
  stage: test  
  variables:
    CNAME: swarm-front
    GIT_STRATEGY: none
  script:
    - docker run --name ${CNAME} -p 8081:80 -it -d ${CNAME}:2.0 
    # - docker tag frontend-angular:2.0 docker-registry.insa.gov.br:5000/frontend-angular:2.0
    # - docker push docker-registry.insa.gov.br:5000/frontend-angular:2.0
  environment:
    name: test
    url: http://${CNAME}:8081
  cache:
    key: site-package
    policy: push
    paths:
     - /home/gitlab-runner/builds/fb7da123/0/operations/frontpage-ui
  only:
    - develop
     
cleanup_build_job:
  stage: cleanup_build
  script: 
    - docker rm -f $(docker ps -aq -f status=exited) 
  when: on_failure

  

